import {
  createClient,
  connectClient as sdkConnectClient,
  disconnectClient as sdkDisconnectClient,
} from '~/client/api';

import { user11 } from './dummy';

export const client = createClient('key', 'sg');

export const connectClient = async () => {
  client.mqtt.connect = jest.fn();
  client.mqtt.subscribe = jest.fn();
  client.http.post = jest.fn().mockReturnValueOnce({
    data: {
      accessToken: 'accessToken',
      refreshToken: 'refreshToken',
      users: [user11],
    },
  });

  setTimeout(() => {
    client.ws.emit('connect');
  }, 500);

  await sdkConnectClient({ userId: 'test' });
};

export const disconnectClient = async () => {
  sdkDisconnectClient().then(() => client.ws.emit('disconnect'));
};

export default {};
